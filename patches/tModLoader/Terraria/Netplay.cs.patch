--- src/Terraria\Terraria\Netplay.cs
+++ src/tModLoader\Terraria\Netplay.cs
@@ -1,18 +_,22 @@
 using System;
+using System.Collections.Concurrent;
 using System.IO;
+using System.Linq;
 using System.Net;
 using System.Net.Sockets;
 using System.Runtime.CompilerServices;
 using System.Threading;
+using System.Threading.Tasks;
 using Terraria.IO;
 using Terraria.Localization;
+using Terraria.ModLoader;
 using Terraria.Net;
 using Terraria.Net.Sockets;
 using Terraria.Social;
 using Terraria.Utilities;
 using Terraria.Social.Base;
 
-#if SERVER
+#if SERVER && WINDOWS
 using NATUPNPLib;
 #endif
 namespace Terraria
@@ -36,7 +_,7 @@
 		public static bool spamCheck = false;
 		public static bool anyClients = false;
 		private static Thread ServerThread;
-		#if SERVER
+#if SERVER && WINDOWS
 		public static UPnPNAT upnpnat;
 		public static IStaticPortMappingCollection mappings;
 #endif
@@ -46,11 +_,27 @@
 
 		public static event Action OnDisconnect;
 
+		private static readonly ConcurrentQueue<Task> mainThreadTasks = new ConcurrentQueue<Task>();
+
+		internal static void OnUpdate()
+		{
+			Task t;
+			while (mainThreadTasks.TryDequeue(out t))
+				t.RunSynchronously();
+		}
+
+		private static void InvokeOnMainThread(Action action)
+		{
+			var t = new Task(action);
+			mainThreadTasks.Enqueue(t);
+			t.Wait();
+		}
+
 		private static void OpenPort()
 		{
 			Netplay.portForwardIP = Netplay.GetLocalIPAddress();
 			Netplay.portForwardPort = Netplay.ListenPort;
-#if SERVER
+#if SERVER && WINDOWS
 			if (Netplay.upnpnat == null)
 			{
 				Netplay.upnpnat = (UPnPNAT)Activator.CreateInstance(Type.GetTypeFromCLSID(new Guid("AE1E00AA-3FD5-403C-8A27-2BBDC30CD0E1")));
@@ -76,7 +_,7 @@
 
 		public static void closePort()
 		{
-#if SERVER
+#if SERVER && WINDOWS
 			if (Netplay.portForwardOpen)
 			{
 				Netplay.mappings.Remove(Netplay.portForwardPort, "TCP");
@@ -237,6 +_,7 @@
 
 		private static void ClientLoopSetup(RemoteAddress address)
 		{
+			Logging.Terraria.InfoFormat("Connecting to {0}", address.GetFriendlyName());
 			Netplay.ResetNetDiag();
 			Main.ServerSideCharacter = false;
 			if (Main.rand == null)
@@ -260,9 +_,11 @@
 			}
 			Netplay.disconnect = false;
 			Netplay.Connection = new RemoteServer();
-			Netplay.Connection.ReadBuffer = new byte[1024];
-		}
-
+			Netplay.Connection.ReadBuffer = new byte[ushort.MaxValue];
+		}
+
+
+		internal static bool syncingWorld = false;
 		private static void InnerClientLoop()
 		{
 			try
@@ -275,7 +_,7 @@
 					{
 						if (NetMessage.buffer[256].checkBytes)
 						{
-							NetMessage.CheckBytes(256);
+							InvokeOnMainThread(() => NetMessage.CheckBytes(256));
 						}
 						Netplay.Connection.IsActive = true;
 						if (Netplay.Connection.State == 0)
@@ -328,6 +_,7 @@
 						{
 							Netplay.Connection.State = 6;
 							Main.player[Main.myPlayer].FindSpawn();
+							Netplay.syncingWorld = true;
 							NetMessage.SendData(8, -1, -1, null, Main.player[Main.myPlayer].SpawnX, (float)Main.player[Main.myPlayer].SpawnY, 0f, 0f, 0, 0, 0);
 						}
 						if (Netplay.Connection.State == 6 && num != Netplay.Connection.State)
@@ -359,7 +_,6 @@
 									});
 							}
 						}
-						Thread.Sleep(1);
 					}
 					else if (Netplay.Connection.IsActive)
 					{
@@ -368,6 +_,7 @@
 					}
 					num = Netplay.Connection.State;
 				}
+				Netplay.syncingWorld = false;
 				try
 				{
 					Netplay.Connection.Socket.Close();
@@ -439,7 +_,7 @@
 			{
 				Netplay.Clients[num].Reset();
 				Netplay.Clients[num].Socket = client;
-				Console.WriteLine(Language.GetTextValue("Net.ClientConnecting", client.GetRemoteAddress()));
+				//Console.WriteLine(Language.GetTextValue("Net.ClientConnecting", client.GetRemoteAddress()));
 			}
 			if (Netplay.FindNextOpenClientSlot() == -1)
 			{
@@ -546,18 +_,26 @@
 				}
 				IL_156:
 				int num3 = 0;
+				if (NetMessage.buffer.Any(b => b.checkBytes) || Clients.Any(c => c.PendingTermination))
+				{
+					InvokeOnMainThread(() =>
+					{
+						for (int k = 0; k < 256; k++)
+						{
+							if (NetMessage.buffer[k].checkBytes)
+							{
+								NetMessage.CheckBytes(k);
+							}
+							if (Netplay.Clients[k].PendingTermination)
+							{
+								Netplay.Clients[k].Reset();
+								NetMessage.SyncDisconnectedPlayer(k);
+							}
+						}
+					});
+				}
 				for (int k = 0; k < 256; k++)
 				{
-					if (NetMessage.buffer[k].checkBytes)
-					{
-						NetMessage.CheckBytes(k);
-					}
-					if (Netplay.Clients[k].PendingTermination)
-					{
-						Netplay.Clients[k].Reset();
-						NetMessage.SyncDisconnectedPlayer(k);
-					}
-					else
 					{
 						if (Netplay.Clients[k].IsConnected())
 						{

